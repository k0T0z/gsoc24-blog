<!DOCTYPE html>
<html lang="">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/gsoc24-blog/assets/css/style.css">
<title>Google Summer of Code 2024 Week 18 and 19: Wrapping Up and Final Evaluation</title>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Google Summer of Code 2024 Week 18 and 19: Wrapping Up and Final Evaluation | k0T0z</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Google Summer of Code 2024 Week 18 and 19: Wrapping Up and Final Evaluation" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This blog post is related to my Google Summer of Code 2024 project: Procedural Fragment Shader Generation Using Classic Machine Learning." />
<meta property="og:description" content="This blog post is related to my Google Summer of Code 2024 project: Procedural Fragment Shader Generation Using Classic Machine Learning." />
<link rel="canonical" href="https://k0t0z.github.io/gsoc24-blog//gsoc24-blog/blog/2024/09/22/google-summer-of-code-2024-week-18-and-19-wrapping-up-and-final-evaluation.html" />
<meta property="og:url" content="https://k0t0z.github.io/gsoc24-blog//gsoc24-blog/blog/2024/09/22/google-summer-of-code-2024-week-18-and-19-wrapping-up-and-final-evaluation.html" />
<meta property="og:site_name" content="k0T0z" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-22T21:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Google Summer of Code 2024 Week 18 and 19: Wrapping Up and Final Evaluation" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-09-22T21:00:00+00:00","datePublished":"2024-09-22T21:00:00+00:00","description":"This blog post is related to my Google Summer of Code 2024 project: Procedural Fragment Shader Generation Using Classic Machine Learning.","headline":"Google Summer of Code 2024 Week 18 and 19: Wrapping Up and Final Evaluation","mainEntityOfPage":{"@type":"WebPage","@id":"https://k0t0z.github.io/gsoc24-blog//gsoc24-blog/blog/2024/09/22/google-summer-of-code-2024-week-18-and-19-wrapping-up-and-final-evaluation.html"},"url":"https://k0t0z.github.io/gsoc24-blog//gsoc24-blog/blog/2024/09/22/google-summer-of-code-2024-week-18-and-19-wrapping-up-and-final-evaluation.html"}</script>
<!-- End Jekyll SEO tag -->


<script type="text/javascript" src="/gsoc24-blog/assets/js/darkmode.js"></script>

</head><body>
  <main class="container">
    <section class="about">
      <div class="about-header ">
      <div class="about-title">
      <a href="/gsoc24-blog/">
        
        <img src="/gsoc24-blog/assets/portfolio.png" alt="Saif Kandil" />
        
      </a>
      <h2 id="title">
        <a href="/gsoc24-blog/">Saif Kandil</a>
      </h2>
      </div><p class="tagline">Just a place for me to dump my thoughts about my Google Summer of Code 2024 project</p></div>
      
      <ul class="social about-footer "><a href="https://github.com/k0T0z" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a></ul><p class="about-footer ">&copy;
        2024</p><div class="about-footer ">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </section>
    <section class="content">
      <div class="post-container">
  <a class="post-link" href="/gsoc24-blog/blog/2024/09/22/google-summer-of-code-2024-week-18-and-19-wrapping-up-and-final-evaluation.html">
    <h2 class="post-title">Google Summer of Code 2024 Week 18 and 19: Wrapping Up and Final Evaluation</h2>
  </a>
  <div class="post-meta">
    <div class="post-date"><i class="icon-calendar"></i>Sep 22, 2024</div><ul class="post-categories"><li>blog</li></ul></div>
  <div class="post">
    <p>This blog post is related to my Google Summer of Code 2024 project: <a href="https://summerofcode.withgoogle.com/programs/2024/projects/wYTZuQbA">Procedural Fragment Shader Generation Using Classic Machine Learning</a>.</p>

<p>My final evaluation report: <a href="https://docs.google.com/document/d/1ahKWo3m9fgqAfR9a3cqaIA08Sns05O68nhalpMNjDd8/edit?usp=sharing">Procedural Fragment Shader Generation Using Classic Machine Learning Google Summer Of Code 2024 Final Report</a>.</p>

<p>What an incredible journey this project has been! While I wish I had more time to devote to it, I’m immensely proud of what I’ve accomplished and the knowledge I’ve gained. The challenges I encountered have only fueled my determination to continue developing this project beyond the Google Summer of Code program. Let me share some of the significant hurdles I overcame and what I learned from them.</p>

<h2 id="major-challenges">Major Challenges</h2>

<h3 id="1-test-runner-compatibility-issues">1. Test Runner Compatibility Issues</h3>

<p>One of the first obstacles I faced was that the <code class="language-plaintext highlighter-rouge">test-runner</code> wouldn’t function on my Arch Linux machine, though it worked fine in an Ubuntu VM. Rather than simply working around this by using the VM, I decided to tackle the issue head-on. This problem had actually first surfaced before my acceptance into the program when attempting to build RGM on Ubuntu.</p>

<p>The issue manifested as a linking error involving Abseil, Protobuf, and gRPC packages. My initial approach was to:</p>
<ol>
  <li>Create a solution called <a href="https://github.com/k0T0z/absl-proto-grpc-ci">absl-proto-grpc-ci</a> to identify compatible versions of all three packages</li>
  <li>Manually clone, build, and install these versions locally to <code class="language-plaintext highlighter-rouge">/usr/local/</code></li>
</ol>

<p>Despite these efforts, the problem persisted until I discovered the root cause: missing library references. The solution was to add <code class="language-plaintext highlighter-rouge">-lgpr</code> and <code class="language-plaintext highlighter-rouge">-labseil_dll</code>/<code class="language-plaintext highlighter-rouge">-labsl_log_internal_message -labsl_log_internal_check_op</code> to the <code class="language-plaintext highlighter-rouge">LD</code> variable.</p>

<h3 id="2-rgm-runtime-error-resolution">2. RGM Runtime Error Resolution</h3>

<p>Addressing the RGM runtime error led to a complete refactoring of RGM’s CMake build system. This process resulted in numerous improvements to the overall build architecture. For detailed information about this issue, I’ve documented it thoroughly in my blog post: <a href="https://k0t0z.github.io/gsoc24-blog/blog/2024/08/04/google-summer-of-code-2024-week-11-12-and-13-rgm.html#runtime-nightmare">Google Summer of Code 2024 Week 11, 12, and 13: RGM: Runtime Nightmare</a>.</p>

<h2 id="implementation-highlights">Implementation Highlights</h2>

<h3 id="the-renderer">The Renderer</h3>

<p>As the project wrapped up, I implemented a simplified renderer solution. While ideally, we would have used ENIGMA’s Graphics System, time constraints led to a different approach. The current implementation uses Qt and includes:</p>
<ul>
  <li>A standalone class for shader preview</li>
  <li>Modifications to the <code class="language-plaintext highlighter-rouge">VisualShader</code> class to generate appropriate header code</li>
</ul>

<p>In my proposal, I mentioned that the Renderer will be done after the generator is done. The thing is I need a context to render the shader on, this could be <a href="https://www.glfw.org/">GLFW</a> or Qt. I decided it will be Qt so moved finishing the Renderer AFTER the <code class="language-plaintext highlighter-rouge">Visual Shader Editor</code> is done.</p>

<p>Robert talked to me about that in <a href="https://k0t0z.github.io/gsoc24-blog/blog/2024/07/07/google-summer-of-code-2024-week-7-8-and-9-my-boogeyperiod.html">Google Summer of Code 2024 Week 7, 8, and 9: My Boogeyperiod</a> by the way.</p>

<blockquote>
  <p>R0bert — 25/08/2024 18:48</p>
</blockquote>

<blockquote>
  <p>are you saying you want to have  a “Preview” window on your shader editor?
that might be more difficult then if you want to do a live preview of that but we can talk about it</p>
</blockquote>

<p>Here’s a glimpse of how the shader code is set:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">shader_program</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span> <span class="nf">QOpenGLShaderProgram</span><span class="p">());</span>

<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">vertex_shader_source</span> <span class="o">=</span> <span class="s">R"(
    #version 330 core
    layout(location = 0) in vec2 aPos;
    layout(location = 1) in vec2 aTexCoord;

    out vec2 TexCoord;

    void main() {
    gl_Position = vec4(aPos, 0.0, 1.0);
    TexCoord = aTexCoord;
    }
)"</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">fragment_shader_source</span> <span class="p">{</span><span class="n">code</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">?</span> <span class="s">R"(
    #version 330 core
    out vec4 FragColor;
    in vec2 TexCoord;

    uniform float uTime;

    void main() {
    FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }
)"</span> <span class="o">:</span> <span class="s">"#version 330 core</span><span class="se">\n\n</span><span class="s">"</span> <span class="o">+</span> <span class="n">code</span><span class="p">};</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">shader_program</span><span class="o">-&gt;</span><span class="n">addShaderFromSourceCode</span><span class="p">(</span><span class="n">QOpenGLShader</span><span class="o">::</span><span class="n">Vertex</span><span class="p">,</span> <span class="n">vertex_shader_source</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">qWarning</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"Vertex shader compilation failed:"</span> <span class="o">&lt;&lt;</span> <span class="n">shader_program</span><span class="o">-&gt;</span><span class="n">log</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">shader_program</span><span class="o">-&gt;</span><span class="n">addShaderFromSourceCode</span><span class="p">(</span><span class="n">QOpenGLShader</span><span class="o">::</span><span class="n">Fragment</span><span class="p">,</span> <span class="n">fragment_shader_source</span><span class="p">.</span><span class="n">c_str</span><span class="p">()))</span> <span class="p">{</span>
    <span class="n">qWarning</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"Fragment shader compilation failed:"</span> <span class="o">&lt;&lt;</span> <span class="n">shader_program</span><span class="o">-&gt;</span><span class="n">log</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">shader_program</span><span class="o">-&gt;</span><span class="n">link</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">qWarning</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"Shader program linking failed:"</span> <span class="o">&lt;&lt;</span> <span class="n">shader_program</span><span class="o">-&gt;</span><span class="n">log</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">shader_needs_update</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span></code></pre></figure>

<p>See the <code class="language-plaintext highlighter-rouge">#version 330 core</code> line in the header, this line is not required by ENIGMA’s Graphics System. This means when it comes to integrate the Renderer with ENIGMA’s Graphics System, some modifications will be made for sure.</p>

<p>if you wanna try the Renderer, you can download this Qt project: <a href="/gsoc24-blog/assets/testshaderrenderer.zip">testshaderrenderer.zip</a>.</p>

<h2 id="protobuf-work">Protobuf Work</h2>

<p>Josh told me to start with this task a while ago <a href="https://k0t0z.github.io/gsoc24-blog/blog/2024/06/30/google-summer-of-code-2024-week-6-the-rush-summer.html#enigma-and-google-protobuf">Google Summer of Code 2024 Week 6: The Rush Summer: ENIGMA and Google Protobuf</a> and I decided to move on and make that change when the editor is done. Now, actually I don’t know how much time it will take to finish this task 🙂. That introduces a very important lesson: DO NOT IGNORE ANY THING THAT JOSH SAYS haha 🤣.</p>

<p>Anyway, I remember talking with Josh and Robert about this task and to handle it.</p>

<blockquote>
  <p>Josh — 31/08/2024 08:10</p>
</blockquote>

<blockquote>
  <p>I think the trouble we’re running into here is that we lack a clear separation of concerns—for a (somewhat outdated) example, model-view-controller
these classes I’m seeing are great for adapting myriad node types to a common UI; as an example, he seems to implement stuff like get_caption so that each node type can just tell the UI what to render for the node
that’s fine; what we want to do is take the stuff inside of those configurable objects and extract those to protos
so we need logic to take a node message and generate the correct node subclass; that’s easy to come up with once the storage format on disk for that info is chosen
basically, all the variables that each box needs to configure with input boxes and sliders and whatever need to be fields in a message; that FloatOpGraphNode message looks more or less fine, modulo some missing tag numbers and optionals</p>
</blockquote>

<blockquote>
  <p>from there, I would store the appropriate message in each GraphNode; personally, I’d probably use a template to accomplish this:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Proto</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">GraphNode</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">get_caption</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="c1">// use Qt translation routines to get the human-readable caption for our message type.</span>
    <span class="c1">// A map would be fine for this, too. Or a custom attribute declared in the proto source.</span>
    <span class="k">return</span> <span class="n">_T</span><span class="p">(</span><span class="n">Proto</span><span class="o">::</span><span class="n">descriptor</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">()</span> <span class="o">+</span> <span class="s">"-caption"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<blockquote>
  <p>a custom attribute would look like this:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">package</span> <span class="n">whatever_proto_package</span><span class="p">;</span>
<span class="n">extend</span> <span class="n">google</span><span class="p">.</span><span class="n">protobuf</span><span class="p">.</span><span class="n">MessageOptions</span> <span class="p">{</span>
  <span class="n">string</span> <span class="n">editor_caption</span> <span class="o">=</span> <span class="mi">50001</span><span class="p">;</span>  <span class="c1">// Define a custom option with a unique field number</span>
<span class="p">}</span>
<span class="n">message</span> <span class="n">FloatOpGraphNode</span> <span class="p">{</span>
  <span class="n">option</span> <span class="p">(</span><span class="n">editor_caption</span><span class="p">)</span> <span class="o">=</span> <span class="s">"Floating Point Operation"</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<blockquote>
  <p>then the C++ would do this:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">get_caption</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
  <span class="c1">// Still translate it because we translate all Qt user strings</span>
  <span class="k">return</span> <span class="n">_T</span><span class="p">(</span><span class="n">Proto</span><span class="o">::</span><span class="n">descriptor</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">().</span><span class="n">GetExtension</span><span class="p">(</span><span class="n">whatever_proto_package</span><span class="o">::</span><span class="n">editor_caption</span><span class="p">));</span>
<span class="p">}</span></code></pre></figure>

<blockquote>
  <p>I omitted a lot of checking for, e.g, the descriptor being null or the option missing or whatever
I’d also advise putting our message extensions in a single proto source for the entire project
like, anywhere we’re already extending MessageOptions, we should define any editor_caption field there
if we’re already doing that, I apologize for the confusion 
and so we’re clear, use whatever of that is helpful to you; I don’t care how you pull that off, protobuf is meant to be a tool to make your life easier
it can just be serialized and written directly to disk or read directly from disk, so I’d expect your UI code to read the entire graph from one binproto/textproto dump, then generate the UI graph nodes from message pointers as we do with our other Qt models
those Qt models are probably a good reference if they don’t confuse you to tears
if they do, ask me</p>
</blockquote>

<blockquote>
  <p>yeah, and storing that data is where the template comes in, though honestly, you can avoid the entirely using proto reflection if you prefer</p>
</blockquote>

<blockquote>
  <p>R0bert — 31/08/2024 19:34</p>
</blockquote>

<blockquote>
  <p>Josh explained, “separate your concerns”, have a GraphNode message that’s templated to take the rest of the parameters for the node
the only reason the source you linked has 50 classes is because its make a type for each one instead of separating the node from the ui</p>
</blockquote>

<p>Yeah, so now this is the biggest problem in my project now. The thing is that ENIGMA is mainly depends on Protobuf for serialization, deserialization, and many other purposes.</p>

<h3 id="noise-kernels">Noise Kernels</h3>

<p>I successfully implemented two additional noise kernels:</p>
<ul>
  <li>Perlin Noise</li>
  <li>Worley Noise</li>
</ul>

<h2 id="project-structure">Project Structure</h2>

<p>The final implementation is integrated into two main repositories:</p>

<ol>
  <li><a href="https://github.com/enigma-dev/enigma-dev">enigma-dev</a>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> enigma-dev
 ├── ...
 ├── CommandLine
 │   ├── ...
 │   └── testing
 │       ├── ...
 │       └── Tests
 │           ├── ...
 │           ├── visual_shader_tests.cpp
 │           ├── visual_shader_nodes_tests.cpp
 │           └── vs_noise_nodes_tests.cpp  
 |
 └── shared
     ├── ...
     └── ResourceTransformations
         └── VisualShader
             ├── README.md
             ├── visual_shader.h
             ├── visual_shader.cpp
             ├── visual_shader_nodes.h
             ├── visual_shader_nodes.cpp
             ├── vs_noise_nodes.h
             └── vs_noise_nodes.cpp
</code></pre></div>    </div>
  </li>
  <li><a href="https://github.com/enigma-dev/RadialGM">RadialGM</a>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> RadialGM
 ├── ...
 ├── Editors
 │   ├── ...
 │   ├── VisualShaderEditor.h
 │   └── VisualShaderEditor.cpp
 |
 └── Tests
     ├── CMakeLists.txt
     ├── tests_main.cpp
     ├── MainWindowTests.h
     ├── MainWindowTests.cpp
     └── Editors
         ├── VisualShaderEditorTests.h
         └── VisualShaderEditorTests.cpp
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="outputs-with-graphs">Outputs With Graphs</h2>

<p>I’ve recreated several textures from <a href="https://thebookofshaders.com/">The Book of Shaders</a>, including:</p>

<p>A simple Wood texture from The Book Of Shaders:</p>

<p><img src="/gsoc24-blog/assets/wood-texture.png" alt="Wood Texture" /></p>

<p>My project’s output:</p>

<p><img src="/gsoc24-blog/assets/ENIGMA-visual-shader-wood-texture.png" alt="ENIGMA Visual Shader Wood Texture" />
<img src="/gsoc24-blog/assets/ENIGMA-visual-shader-wood-texture2.png" alt="ENIGMA Visual Shader Wood Texture" /></p>

<p>Check out the texture demo at <a href="https://youtu.be/9F7YYRG7MkM?si=mdgc4BBncT7IXNKa">https://youtu.be/9F7YYRG7MkM?si=mdgc4BBncT7IXNKa</a>.</p>

<hr />

<p>A simple Splatter texture from The Book Of Shaders:</p>

<p><img src="/gsoc24-blog/assets/splatter-texture.png" alt="Splatter Texture" /></p>

<p>My project’s output:</p>

<p><img src="/gsoc24-blog/assets/ENIGMA-visual-shader-splatter-texture.png" alt="ENIGMA Visual Shader Splatter Texture" />
<img src="/gsoc24-blog/assets/ENIGMA-visual-shader-splatter-texture2.png" alt="ENIGMA Visual Shader Splatter Texture" /></p>

<p>Check out the texture demo at <a href="https://youtu.be/AgsveEXKu8Y?si=G_VDLM0u-G-0w-wJ">https://youtu.be/AgsveEXKu8Y?si=G_VDLM0u-G-0w-wJ</a>.</p>

<p>The Splatter texture implementation led to several important fixes in the noise kernels, documented in these commits:</p>
<ul>
  <li><a href="https://github.com/enigma-dev/enigma-dev/pull/2399/commits/4c716895d46130ec2cf7bbd8fd95806124563977">4c716895d46130ec2cf7bbd8fd95806124563977</a></li>
  <li><a href="https://github.com/enigma-dev/enigma-dev/pull/2399/commits/55a050609592a0b2b1cfac8a526c84c133ed6c7d">55a050609592a0b2b1cfac8a526c84c133ed6c7d</a></li>
  <li><a href="https://github.com/enigma-dev/enigma-dev/pull/2399/commits/7a8aa69d1445c6f77895b2f6d2784104c717fbc1">7a8aa69d1445c6f77895b2f6d2784104c717fbc1</a></li>
</ul>

<hr />


  </div></div>

    </section>
    <footer class="">
      <ul class="social about-footer "><a href="https://github.com/k0T0z" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a></ul><p class="about-footer ">&copy;
        2024</p><div class="about-footer ">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </footer>
  </main>
  
  <script type="text/javascript" src="/gsoc24-blog/assets/js/darkmode.js"></script>
  
  <script src="/gsoc24-blog/assets/js/simple-jekyll-search.min.js"></script>
  <script src="/gsoc24-blog/assets/js/search.js"></script>
  
</body>

</html>
